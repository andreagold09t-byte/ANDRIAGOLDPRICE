<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="WL-OcyEw8VeASMaBK7v6aA7SVRp01r8cUjyFw1c82AY" />
<title>Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Cairo', sans-serif;
    background: linear-gradient(135deg, #111827, #1f2937);
    margin: 0;
    padding: 20px;
    color: white;
}

h1 {
    text-align: center;
    color: gold;
    margin-bottom: 30px;
}

.section-title {
    margin-top: 30px;
    font-size: 22px;
    color: #fbbf24;
    border-bottom: 2px solid #fbbf24;
    padding-bottom: 5px;
}

.container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.card {
    background: #1f2937;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    transition: 0.3s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(255,215,0,0.4);
}

.card-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #facc15;
    font-size: 18px;
}

.price {
    font-size: 20px;
}

.sell { color: #22c55e; }
.buy { color: #ef4444; }

.footer {
    text-align: center;
    margin-top: 40px;
    font-size: 14px;
    opacity: 0.8;
    color: #fbbf24;
}
</style>
</head>

<body>

<h1>Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ Ù„Ø­Ø¸ÙŠÙ‹Ø§ Ù…Ø¹ Ù…ØµÙˆØºØ§Øª Ø§Ù†Ø¯Ø±ÙŠØ§</h1>

<div class="section-title">Ø§Ù„Ø°Ù‡Ø¨</div>
<div class="container" id="gold"></div>

<div class="section-title">Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div>
<div class="container" id="currency"></div>

<div class="footer">
    Web Developed by TomasAtef
</div>

<script>
const CACHE_KEY = "gold_prices_cache";

async function fetchPrices() {
    const goldContainer = document.getElementById('gold');
    const currencyContainer = document.getElementById('currency');

    // ğŸ¥‡ 1- Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø´ ÙÙˆØ±Ù‹Ø§
    const cached = localStorage.getItem(CACHE_KEY);
    if (cached) {
        renderPrices(JSON.parse(cached));
    } else {
        goldContainer.innerHTML = "<div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...</div>";
    }

    // ğŸ¥ˆ 2- Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    try {
        const res = await fetch('/api/prices');
        const data = await res.json();

        // Ø­ÙØ¸ Ø§Ù„ÙƒØ§Ø´
        localStorage.setItem(CACHE_KEY, JSON.stringify(data));

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø´Ø©
        renderPrices(data);

    } catch (err) {
        console.log("Offline mode");
    }
}

// ğŸ¯ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
function renderPrices(data) {
    const goldContainer = document.getElementById('gold');
    const currencyContainer = document.getElementById('currency');

    goldContainer.innerHTML = '';
    currencyContainer.innerHTML = '';

    for (const [key, value] of Object.entries(data)) {
        const card = document.createElement('div');
        card.className = 'card';

        if (typeof value === 'object') {
            card.innerHTML = 
                <div class="card-title">${key}</div>
                <div class="price sell">Ø¨ÙŠØ¹: ${value.Ø¨ÙŠØ¹} Ø¬Ù†ÙŠÙ‡</div>
                <div class="price buy">Ø´Ø±Ø§Ø¡: ${value.Ø´Ø±Ø§Ø¡} Ø¬Ù†ÙŠÙ‡</div>
            ;
            goldContainer.appendChild(card);
        } else {
            card.innerHTML = 
                <div class="card-title">${key}</div>
                <div class="price">${value} Ø¬Ù†ÙŠÙ‡</div>
            ;
            currencyContainer.appendChild(card);
        }
    }
}

// ØªØ´ØºÙŠÙ„
fetchPrices();
setInterval(fetchPrices, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
</script>

<hr style="margin:30px 0">

<!-- Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°Ù‡Ø¨ -->
<div style="background:#111; padding:15px; border-radius:10px; max-width:400px">

    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø±Ø§Ù…Ø§Øª:</label><br>
    <input type="number" id="grams" placeholder="Ù…Ø«Ù„Ø§ 10" style="width:100%; padding:8px; margin:5px 0"><br>

    <label>Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø±:</label><br>
    <select id="karat" style="width:100%; padding:8px; margin:5px 0">
        <option value="24">Ø¹ÙŠØ§Ø± 24</option>
        <option value="21">Ø¹ÙŠØ§Ø± 21</option>
        <option value="18">Ø¹ÙŠØ§Ø± 18</option>
        <option value="14">Ø¹ÙŠØ§Ø± 14</option>
    </select>

    <label>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</label><br>
    <select id="type" style="width:100%; padding:8px; margin:5px 0">
        <option value="Ø¨ÙŠØ¹">Ø¨ÙŠØ¹</option>
        <option value="Ø´Ø±Ø§Ø¡">Ø´Ø±Ø§Ø¡</option>
    </select>

    <button onclick="calcGold()" style="width:100%; padding:10px; background:gold; border:none; font-weight:bold; cursor:pointer">
        Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±
    </button>

    <h3 id="result" style="margin-top:15px; color:gold"></h3>
    <p id="note" style="margin-top:5px; font-size:14px; color:#fbbf24;"></p>
</div>

<script>
async function calcGold() {
    const grams = parseFloat(document.getElementById("grams").value);
    const karat = document.getElementById("karat").value;
    const type = document.getElementById("type").value;

    if (!grams || grams <= 0) {
        document.getElementById("result").innerText = "Ø§ÙƒØªØ¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø±Ø§Ù…Ø§Øª ØµØ­ÙŠØ­";
        document.getElementById("note").innerText = "";
        return;
    }

    try {
        const res = await fetch("/api/prices");
        const data = await res.json();
        console.log("Data from backend:", data); // Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø´ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

        const key = Object.keys(data).find(k => k.includes("Ø§Ù„Ø°Ù‡Ø¨ Ø¹ÙŠØ§Ø± " + karat));

        if (!key || !data[key]) {
            document.getElementById("result").innerText = "Ù…Ø´ Ù„Ø§Ù‚ÙŠ Ø§Ù„Ø³Ø¹Ø± Ø­Ø§Ù„ÙŠØ§Ù‹";
            document.getElementById("note").innerText = "";
            return;
        }

        let priceText = type === "Ø´Ø±Ø§Ø¡" ? data[key]["Ø´Ø±Ø§Ø¡"] : data[key]["Ø¨ÙŠØ¹"];
        let price = parseFloat(priceText.toString().replace(/[^\d.]/g, ""));

        if (type === "Ø¨ÙŠØ¹") {
            price = price * 0.98; // Ø®ØµÙ… 2%
        }

        const total = grams * price;

        document.getElementById("result").innerText =
            `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ (${type}): ${total.toFixed(0)} Ø¬Ù†ÙŠÙ‡`;

        document.getElementById("note").innerText = type === "Ø´Ø±Ø§Ø¡" 
            ? "Ù…Ù„Ø­ÙˆØ¸Ø©: Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ù…ØµÙ†Ø¹ÙŠØ©" 
            : "Ù…Ù„Ø­ÙˆØ¸Ø©: Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø¯ÙˆÙ† Ø®ØµÙ… %2";

    } catch (e) {
        console.error(e);
        document.getElementById("result").innerText = "Ø­ØµÙ„ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
        document.getElementById("note").innerText = "";
    }
}
</script>

</body>
</html>


