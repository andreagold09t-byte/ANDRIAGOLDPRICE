<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="WL-OcyEw8VeASMaBK7v6aA7SVRp01r8cUjyFw1c82AY" />
<title>أسعار الذهب</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Cairo', sans-serif;
    background: linear-gradient(135deg, #111827, #1f2937);
    margin: 0;
    padding: 20px;
    color: white;
}

h1 {
    text-align: center;
    color: gold;
    margin-bottom: 30px;
}

.section-title {
    margin-top: 30px;
    font-size: 22px;
    color: #fbbf24;
    border-bottom: 2px solid #fbbf24;
    padding-bottom: 5px;
}

.container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.card {
    background: #1f2937;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    transition: 0.3s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(255,215,0,0.4);
}

.card-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #facc15;
    font-size: 18px;
}

.price {
    font-size: 20px;
}

.sell { color: #22c55e; }
.buy { color: #ef4444; }

.footer {
    text-align: center;
    margin-top: 40px;
    font-size: 14px;
    opacity: 0.8;
    color: #fbbf24;
}
</style>
</head>

<body>

<h1>أسعار الذهب لحظيًا مع مصوغات اندريا</h1>

<div class="section-title">الذهب</div>
<div class="container" id="gold"></div>

<div class="section-title">العملات</div>
<div class="container" id="currency"></div>


<script>
async function fetchPrices() {
    try {
        const res = await fetch('/api/prices');
        const data = await res.json();

        const goldContainer = document.getElementById('gold');
        const currencyContainer = document.getElementById('currency');

        goldContainer.innerHTML = '';
        currencyContainer.innerHTML = '';

        for (const [key, value] of Object.entries(data)) {
            const card = document.createElement('div');
            card.className = 'card';

            if (typeof value === 'object') {
                card.innerHTML = `
                    <div class="card-title">${key}</div>
                    <div class="price sell">بيع: ${value.بيع} جنيه</div>
                    <div class="price buy">شراء: ${value.شراء} جنيه</div>
                `;
                goldContainer.appendChild(card);
            } else {
                card.innerHTML = `
                    <div class="card-title">${key}</div>
                    <div class="price">${value} جنيه</div>
                `;
                currencyContainer.appendChild(card);
            }
        }

    } catch (err) {
        console.error("خطأ في جلب البيانات", err);
    }
}

fetchPrices();
setInterval(fetchPrices, 60000);
</script>
<hr style="margin:30px 0">

<!-- حاسبة الذهب -->
<div style="background:#111; padding:15px; border-radius:10px; max-width:400px">

    <label>عدد الجرامات:</label><br>
    <input type="number" id="grams" placeholder="مثلا 10" style="width:100%; padding:8px; margin:5px 0"><br>

    <label>اختر العيار:</label><br>
    <select id="karat" style="width:100%; padding:8px; margin:5px 0">
        <option value="24">عيار 24</option>
        <option value="21">عيار 21</option>
        <option value="18">عيار 18</option>
        <option value="14">عيار 14</option>
    </select>

    <label>اختر نوع العملية:</label><br>
    <select id="type" style="width:100%; padding:8px; margin:5px 0">
        <option value="بيع">بيع</option>
        <option value="شراء">شراء</option>
    </select>

    <button onclick="calcGold()" style="width:100%; padding:10px; background:gold; border:none; font-weight:bold; cursor:pointer">
        احسب السعر
    </button>

    <h3 id="result" style="margin-top:15px; color:gold"></h3>
    <p id="note" style="margin-top:5px; font-size:14px; color:#fbbf24;"></p>
</div>

<script>
async function calcGold() {
    const grams = parseFloat(document.getElementById("grams").value);
    const karat = document.getElementById("karat").value;
    const type = document.getElementById("type").value;

    if (!grams || grams <= 0) {
        document.getElementById("result").innerText = "اكتب عدد الجرامات صحيح";
        document.getElementById("note").innerText = "";
        return;
    }

    try {
        const res = await fetch("/api/prices");
        const data = await res.json();
        console.log("Data from backend:", data); // للتأكد من شكل البيانات

        const key = Object.keys(data).find(k => k.includes("الذهب عيار " + karat));

        if (!key || !data[key]) {
            document.getElementById("result").innerText = "مش لاقي السعر حالياً";
            document.getElementById("note").innerText = "";
            return;
        }

        let priceText = type === "شراء" ? data[key]["شراء"] : data[key]["بيع"];
        let price = parseFloat(priceText.toString().replace(/[^\d.]/g, ""));

        if (type === "بيع") {
            price = price * 0.98; // خصم 2%
        }

        const total = grams * price;

        document.getElementById("result").innerText =
            `السعر التقريبي (${type}): ${total.toFixed(0)} جنيه`;

        document.getElementById("note").innerText = type === "شراء" 
            ? "ملحوظة: السعر غير شامل الضريبة والمصنعية" 
            : "ملحوظة: البيع بدون خصم %2";

    } catch (e) {
        console.error(e);
        document.getElementById("result").innerText = "حصل خطأ في الاتصال";
        document.getElementById("note").innerText = "";
    }
}
</script>
    
<div class="footer">
    Web Developed by TomasAtef
</div>

</body>
</html>




